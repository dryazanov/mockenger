<mkngr-navbar></mkngr-navbar>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3" ng-controller="GroupListController">
            <button type="button" class="btn btn-primary btn-sm btn-block" ng-click="createGroup()">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                Create group
            </button>

            <div id="group-list">
                <table class="table">
                    <tr ng-class="{active: isActive(group)}" ng-repeat="group in groupListService.getData() track by $index">
                        <td class="col-md-10">
                            <a href ng-click="loadGroupRequests(group)">
                                {{group.name}}
                            </a>
                            &nbsp;
                            <span ng-show="!group.recording" class="label label-info">Not recording</span>
                            <span ng-show="group.recording" class="label label-danger">Recording</span>
                        </td>
                        <td class="col-md-1">
                            <button class="btn btn-xs" ng-click="editGroup(group)">
                                <span class="glyphicon glyphicon-cog"></span>
                            </button>
                        </td>
                        <td class="col-md-1">
                            <button class="btn btn-xs" ng-really-click="deleteGroup($index, group)"
                                    ng-really-message="Do you really want to delete group '{{project.name}}' with all its mocks?">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="col-md-9" ng-controller="RequestListController">
            <div ng-if="requestsService.getData() != null" class="panel panel-primary">
                <div class="panel-heading">
                    <form class="form-inline">
                        <div class="form-group">
                            <input type="search" ng-model="requestsService.filters.search.query" class="form-control" id="searchRequests" placeholder="Search">
                        </div>
                        <div class="form-group">
                            <select ng-model="requestsService.filters.order" id="orderRequests" class="form-control">
                                <optgroup label="Order by">
                                    <option value="name">Name</option>
                                    <option value="creationDate">Date</option>
                                    <option value="method">Method</option>
                                </optgroup>
                            </select>
                        </div>
                    </form>
                </div>

                <div class="panel-body">
                    <div ng-if="pageCount() < 0">
                        No results found.<br/><br/>
                        <button type="button" class="btn btn-primary btn-sm" ng-click="createRequest()">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                            Create request
                        </button>
                    </div>
                    <table class="table table-striped table-hover" ng-if="pageCount() >= 0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Creation date</th>
                                <th>Path</th>
                                <th>Method</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-class="{info: request.id == requestsService.getCurrent().id}"
                                ng-click="requestsService.setCurrent(request)"
                                ng-repeat="request in requestsService.getData()
                                    | filter:requestsService.getSearchQuery()
                                    | orderBy:requestsService.getListOrder()
                                    | offset:getOffset()
                                    | limitTo:requestsService.getLimit() track by $index">

                                <td>{{request.name}}</td>
                                <td>{{request.creationDate | date:'dd-MM-yyyy HH:mm:ss'}}</td>
                                <td>@{{request.path.value}}</td>
                                <td>{{request.method}}</td>
                                <td>
                                    <button class="btn btn-xs" ng-really-click="deleteRequest($index)"
                                            ng-really-message="Do you really want to delete this request?">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="panel-footer" ng-show="pageCount() > 0">
                    <!--Current page: {{getCurrentPage() + 1}} Total pages: {{pageCount() + 1}}-->
                    <nav>
                        <ul class="pagination">
                            <li ng-class="prevPageDisabled()">
                                <a href ng-click="prevPage()" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            <li ng-repeat="n in range()" ng-class="isActive(n)">
                                <a href ng-click="requestsService.setCurrentPage(n)">{{n+1}}</a>
                            </li>

                            <li ng-class="nextPageDisabled()">
                                <a href ng-click="nextPage()" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div ng-if="requestsService.getData() == null" class="alert alert-info" role="alert">
                <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Please select a group
            </div>

            <div class="row">
                <div class="col-md-12" ng-controller="RequestController">
                    <div ng-if="requestsService.getCurrent()" class="panel panel-primary">
                        <div class="panel-heading">
                            {{requestsService.getCurrent().name}}
                        </div>
                        <div class="panel-body">
                            <div class="container-fluid">
                                <div class="row">

                                    <div class="col-md-12">
                                        <tabset>
                                            <tab heading="Main">
                                                <br/>
                                                <div class="form-group">
                                                    <label for="url">Name</label>
                                                    <table class="table">
                                                        <tr>
                                                            <td>
                                                                <input type="text" name="requestName" id="requestName" ng-model="requestsService.getCurrent().name" class="form-control" aria-describedby="sizing-addon1">
                                                                <p ng-show="groupForm.requestName.$invalid && !groupForm.requestName.$pristine" class="help-block">Name is required.</p>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="form-group">
                                                    <table class="table">
                                                        <tr>
                                                            <td class="col-lg-2">
                                                                <label>Creation date</label>
                                                            </td>
                                                            <td>
                                                                {{requestsService.getCurrent().creationDate | date:'dd-MM-yyyy HH:mm:ss'}}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td class="col-lg-2">
                                                                <label>Request unique code</label>
                                                            </td>
                                                            <td>
                                                                {{requestsService.getCurrent().uniqueCode}}
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                            <tab heading="Path">
                                                <br/>
                                                <!--<pre>http://localhost/rest/group1234567890/{{requestsService.getCurrent().path.value}}</pre>-->

                                                <div class="form-group">
                                                    <label for="url">Path</label>
                                                    <table class="table">
                                                        <tr>
                                                            <td>
                                                                <div class="input-group">
                                                                    <div class="input-group-btn">
                                                                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                                                                aria-haspopup="true" aria-expanded="false">{{requestsService.getCurrent().method}} <span class="caret"></span></button>
                                                                        <ul class="dropdown-menu">
                                                                            <li ng-repeat="method in requestMethods">
                                                                                <a href ng-click="selectMethod(method)">{{method}}</a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                    <input type="text" name="url" id="url" ng-model="requestsService.getCurrent().path.value" class="form-control" aria-describedby="sizing-addon1">
                                                                </div>
                                                                <p ng-show="groupForm.path.$invalid && !groupForm.path.$pristine" class="help-block">Path is required.</p>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label>Transformers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="pathTransformer in requestsService.getCurrent().path.transformers">
                                                            <td class="col-lg-2">
                                                                <select ng-model="pathTransformer.type" class="form-control">
                                                                    <option ng-repeat="typeName in transformerTypes">{{typeName}}</option>
                                                                </select>
                                                            </td>
                                                            <td class="col-lg-5">
                                                                    <input type="text" ng-model="pathTransformer.pattern" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="pathTransformer.replacement" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteTransformer($index, requestsService.getCurrent().path.transformers)"
                                                                        ng-really-message="Do you really want to delete this transformer?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                                <a href ng-click="addPathTransformer()">Add transformer</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                            <tab heading="Parameters">
                                                <br/>
                                                <!--<pre>?{{requestsService.getCurrent().parameters.values}}</pre>-->

                                                <div class="form-group">
                                                    <label for="url">Parameters</label>
                                                    <table class="table">
                                                        <tr ng-repeat="parameter in requestsService.getCurrent().parameters.values track by $index">
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="parameter.key" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="parameter.value" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteParameter($index)"
                                                                        ng-really-message="Do you really want to delete this parameter?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="3">
                                                                <a href ng-click="addParameter()">Add parameter</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label>Transformers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="paramTransformer in requestsService.getCurrent().parameters.transformers">
                                                            <td class="col-lg-2">
                                                                <select ng-model="paramTransformer.type" required class="form-control">
                                                                    <option ng-repeat="typeName in transformerTypes">{{typeName}}</option>
                                                                </select>
                                                            </td>
                                                            <td class="col-lg-5">
                                                                <input type="text" ng-model="paramTransformer.pattern" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="paramTransformer.replacement" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteTransformer($index, requestsService.getCurrent().parameters.transformers)"
                                                                        ng-really-message="Do you really want to delete this transformer?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                                <a href ng-click="addParamTransformer()">Add transformer</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                            <tab heading="Headers">
                                                <br/>
                                                <!--<pre>?{{requestsService.getCurrent().headers.values}}</pre>-->

                                                <div class="form-group">
                                                    <label for="url">Headers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="requestHeader in requestsService.getCurrent().headers.values track by $index">
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="requestHeader.key" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="requestHeader.value" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteHeader($index, requestsService.getCurrent().headers.values)"
                                                                        ng-really-message="Do you really want to delete this header?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="3">
                                                                <a href ng-click="addRequestHeader()">Add header</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label>Transformers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="headerTransformer in requestsService.getCurrent().headers.transformers">
                                                            <td class="col-lg-2">
                                                                <select ng-model="headerTransformer.type" required class="form-control">
                                                                    <option ng-repeat="typeName in transformerTypes">{{typeName}}</option>
                                                                </select>
                                                            </td>
                                                            <td class="col-lg-5">
                                                                <input type="text" ng-model="headerTransformer.pattern" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="headerTransformer.replacement" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteTransformer($index, requestsService.getCurrent().headers.transformers)"
                                                                        ng-really-message="Do you really want to delete this transformer?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                                <a href ng-click="addHeaderTransformer()">Add transformer</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                            <tab heading="Request">
                                                <br/>
                                                <!--<pre>{{requestsService.getCurrent().body.value}}</pre>-->

                                                <div class="form-group">
                                                    <label>Transformers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="bodyTransformer in requestsService.getCurrent().body.transformers">
                                                            <td class="col-lg-2">
                                                                <select ng-model="bodyTransformer.type" required class="form-control">
                                                                    <option ng-repeat="typeName in transformerTypes">{{typeName}}</option>
                                                                </select>
                                                            </td>
                                                            <td class="col-lg-5">
                                                                <input type="text" ng-model="bodyTransformer.pattern" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="bodyTransformer.replacement" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteTransformer($index, requestsService.getCurrent().body.transformers)"
                                                                        ng-really-message="Do you really want to delete this transformer?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                                <a href ng-click="addRequestBodyTransformer()">Add transformer</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label for="requestBody">Request body</label>
                                                    <table class="table">
                                                        <tr>
                                                            <td>
                                                                <textarea ng-model="requestsService.getCurrent().body.value" name="requestBody" id="requestBody"
                                                                          class="form-control" aria-describedby="sizing-addon1" rows="10"></textarea>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                            <tab heading="Response">
                                                <br/>
                                                <!--<pre>{{requestsService.getCurrent().mockResponse.body}}</pre>-->

                                                <div class="form-group">
                                                    <label for="url">Headers</label>
                                                    <table class="table">
                                                        <tr ng-repeat="responseHeader in requestsService.getCurrent().mockResponse.headers track by $index">
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="responseHeader.key" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td class="col-lg-6">
                                                                <input type="text" ng-model="responseHeader.value" class="form-control" aria-describedby="sizing-addon1">
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-x" ng-really-click="deleteHeader($index, requestsService.getCurrent().mockResponse.headers)"
                                                                        ng-really-message="Do you really want to delete this header?">
                                                                    <span class="glyphicon glyphicon-trash"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="3">
                                                                <a href ng-click="addResponseHeader()">Add header</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label for="httpStatus">HTTP status code</label>
                                                    <table class="table">
                                                        <tr>
                                                            <td>
                                                                <input type="text" name="httpStatus" id="httpStatus" ng-model="requestsService.getCurrent().mockResponse.httpStatus"
                                                                       class="form-control" aria-describedby="sizing-addon1">
                                                                <p ng-show="groupForm.httpStatus.$invalid && !groupForm.httpStatus.$pristine" class="help-block">HTTP status code is required.</p>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>

                                                <div class="form-group">
                                                    <label for="responseBody">Response body</label>
                                                    <table class="table">
                                                        <tr>
                                                            <td>
                                                                <textarea ng-model="requestsService.getCurrent().mockResponse.body" name="responseBody" id="responseBody"
                                                                          class="form-control" aria-describedby="sizing-addon1" rows="10"></textarea>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </tab>
                                        </tabset>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" ng-disabled="projectForm.$invalid" ng-click="saveRequest(requestsService.getCurrent())">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Group -->
<div class="modal fade" id="groupModal" tabindex="-1" role="dialog" aria-labelledby="groupModalLabel" ng-controller="GroupController">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form name="groupForm" novalidate>
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="requestModalLabel">{{groupToSave.id == null ? 'Create group' : 'Edit group'}}</h4>
                </div>
                <div class="modal-body">
                    <div>
                        <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" dismiss-on-timeout="true">{{alert.msg}}</alert>
                    </div>
                    <input type="hidden" ng-model="groupToSave.projectId">
                    <input type="hidden" ng-model="groupToSave.id">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" name="name" id="name" ng-model="groupToSave.name" class="form-control" required>
                        <p ng-show="groupForm.name.$invalid && !groupForm.name.$pristine" class="help-block">Group name is required.</p>
                    </div>
                    <div class="form-group">
                        <label for="recording">Record incoming requests</label>
                        <div class="form-group">
                            <div class="btn-group" id="recording">
                                <label class="btn btn-primary" ng-model="groupToSave.recording" btn-radio="true">Yes</label>
                                <label class="btn btn-primary" ng-model="groupToSave.recording" btn-radio="false">&nbsp;No&nbsp;</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" ng-disabled="groupForm.$invalid" ng-click="saveGroup(groupToSave)">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
