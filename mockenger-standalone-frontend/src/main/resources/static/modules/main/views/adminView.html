<mkngr-navbar></mkngr-navbar>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default" ng-controller="AccountListController">
                <ul class="list-group">
                    <li class="list-group-item">
                        <h3>
                            <div class="pull-right">
                                <button type="button" class="btn btn-warning btn-sm" ng-click="createAccount()">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                </button>
                            </div>
                            Accounts
                            <div class="clearfix"></div>
                        </h3>
                    </li>
                    <li class="list-group-item" ng-repeat="account in accountListService.getData()">
                        <div class="pull-right">
                            <button class="btn-primary btn-xs" ng-click="editAccount(account)">
                                <span class="glyphicon glyphicon-cog"></span>
                            </button>
                            <button class="btn-primary btn-xs" ng-click="deleteAccount(account)">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </div>
                        <div>
                            {{account.username}}
                            &nbsp;
                            <span class="label label-success">{{account.role}}</span>
                        </div>
                    </li>
                </ul>
                <div class="panel-footer">&nbsp;</div>
            </div>
        </div>

        <div class="col-md-8" ng-controller="EventListController">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3>
                        Account events
                    </h3>
                </div>

                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Event&nbsp;date</th>
                            <th>Changed by</th>
                            <th>User</th>
                            <th>Event type</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="event in eventListService.getData().content">
                            <td class="col-md-2"><a href ng-click="selectRequest($index, request)">{{event.eventDate | date:'dd-MM-yyyy HH:mm:ss'}}</a></td>
                            <td class="col-md-2">{{event.username}}</td>
                            <td class="col-md-4">{{event.entity.firstName}} {{event.entity.lastName}} ({{event.entity.username}})</td>
                            <td class="col-md-1">{{event.eventType}}</td>
                            <td class="col-md-1">{{event.resultType}}</td>
                        </tr>
                    </tbody>
                </table>

                <div class="panel-footer" ng-show="pageCount() > 1">
                    <ul class="pagination pull-right">
                        <li ng-class="{disabled: isPrevPageDisabled()}">
                            <a href ng-click="prevPage()" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        <li ng-repeat="n in range()" ng-class="{active: isActive(n)}">
                            <a href ng-click="updateEventList(eventEntityType, n)">{{n+1}}</a>
                        </li>

                        <li ng-class="{disabled: isNextPageDisabled()}">
                            <a href ng-click="nextPage()" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Account -->
<div class="modal fade" id="accountModal" tabindex="-1" role="dialog" aria-labelledby="accountModalLabel" ng-controller="AccountController">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form name="accountForm" novalidate>
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="requestModalLabel">{{currentAccount.id == null ? 'Create account' : 'Edit account'}}</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" ng-model="currentAccount.id">
                    <div class="form-group" ng-class="getErrorStyle(accountForm.username)">
                        <label for="username">Username</label>
                        <input type="text" name="username" id="username" ng-model="currentAccount.username" class="form-control" required>
                        <p ng-show="hasError(accountForm.username)" class="help-block">Username is required</p>
                    </div>
                    <div class="form-group" ng-class="getErrorStyle(accountForm.firstName)">
                        <label for="firstName">First name</label>
                        <input type="text" name="firstName" id="firstName" ng-model="currentAccount.firstName" class="form-control" required>
                        <p ng-show="hasError(accountForm.firstName)" class="help-block">First name is required</p>
                    </div>
                    <div class="form-group" ng-class="getErrorStyle(accountForm.lastName)">
                        <label for="lastName">Last name</label>
                        <input type="text" name="lastName" id="lastName" ng-model="currentAccount.lastName" class="form-control" required>
                        <p ng-show="hasError(accountForm.lastName)" class="help-block">Last name is required</p>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" id="password" ng-model="currentAccount.password" class="form-control">
                    </div>
                    <div class="form-group" ng-class="accountForm.repassword.$invalid ? 'has-error': ''">
                        <label for="repassword">Confirm password</label>
                        <input type="password" name="repassword" id="repassword" ng-model="currentAccount.repassword" class="form-control">
                        <p ng-show="accountForm.repassword.$invalid" class="help-block">'Password' and 'Confirm password' are not equal</p>
                    </div>
                    <div class="form-group">
                        <label for="roles">Roles</label>
                        <div class="form-group">
                            <div class="btn-group" id="roles">
                                <label ng-repeat="role in roles" class="btn btn-primary" btn-radio="'{{role}}'" ng-model="currentAccount.role">{{role}}</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" ng-disabled="accountForm.$invalid" ng-click="saveAccount(currentAccount)">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>